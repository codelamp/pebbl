async("theory.plugins.dom",["theory"],function(e){var t=e;return e.plugins=e.plugins||{},e.plugins.dom=t.dom||t.creator.callable({i:null,prep:function(){this.i={},this.i.items=[]},findSimple:function(){return document.querySelectorAll?this.i.items=to.array(document.querySelectorAll(this.implodeQuery(arguments))):this.i.items=this.explodedQuery(arguments),this},implodeQuery:function(e){var t,n="",r=0,i=e;for(i.length;t=i[r];r++){if(t.join)if("@"===t[0].charAt(0))switch(t[0]=t[0].substring(1,t[0].length),t.length){case 1:t="["+t[0]+"]";break;case 3:t="["+t[0]+t[1]+'"'+t[2]+'"]';break;default:throw new Error("unable to understand implosion of attribute.")}else t=t.join("");n+=" "+t}return n},explodedQuery:function(e,t){return is.element(e[0])&&(t=(e=to.array(e)).shift()),t||(t=document.documentElement),t=this.explodedQueryParticle(e,t,{combinator:" "})},explodedQueryParticle:function(e,t,n,r){r&&(r.content=e,r.level++);var i,l=0,a=e;for(a.length;i=a[l];l++){if(is.array(i))t=this.explodedQueryParticle(i,t,n,r||{level:0});else if(is.string(i)){if(r)r.i=l;else{if(">"===i){if(">"===n.combinator)throw new Error("unexpected child combinator: "+e.join(" "));n.combinator=">";continue}if("+"===i||"~"===i)throw new Error(i+" combinator not supported by t.dom at early load.")}t=this.explodedQueryParticleBit(i,t,n,r)," "!==n.combinator&&(n.combinator=" "),r&&r.i!==l&&(l=r.i)}if(!t)break}return t},explodedQueryParticleBit:function(e,t,n,r){var i,l,a=0,s=this.bits;for(s.length;(l=s[a])&&(l.pattern!==!0&&!l.pattern.test(e)||!(i=l.handler.apply(this,arguments)));a++);return i.callback&&(t=i.filter?this.filterElementsBy(t,i.callback):">"===n.combinator?this.filterElementsBy(t,i.callback,!0):this.findElementsBy(t,i.callback)),t},bits:[{pattern:/^\./,handler:function(e,t,n,r){return{callback:this.getElementHasClassNameCheck(e.substring(1,e.length)),filter:!!r}}},{pattern:/^@/,handler:function(e,t,n,r){var i={};if(e=e.substring(1,e.length),r&&0===r.i)switch(i.filter=r.level>1,r.content.length){case 1:i.callback=this.getElementHasAttributeCheck(e);break;case 3:i.callback=this.getElementHasAttributeCheck(e,{comparison:r.content[1],value:r.content[2]}),r.i+=2;break;case 4:i.callback=this.getElementHasAttributeCheck(e,{comparison:r.content[1],value:r.content[2],caseInsensitive:"i"===r.content[3]}),r.i+=3;break;default:throw new Error("unexpected format of attribute selector")}else i.callback=this.getElementHasAttributeCheck(e),i.filter=r.i>0;return i}},{pattern:!0,handler:function(e,t,n,r){return{callback:this.getElementHasTagNameCheck(e),filter:!1}}}],findElementsBy:function(e,t,n,r){if(!n&&(n=[]),!r&&(r=0),is.arraylike(e)){var i,l=0,a=e;for(a.length;i=a[l];l++)i&&1===i.nodeType&&(r>0&&t.call(this,i)&&n.push(i),i.childNodes&&this.findElementsBy(i.childNodes,t,n,r+1))}else is.element(e)&&this.findElementsBy(e.childNodes,t,n,r);return 0===r?n:null},filterElementsBy:function(e,t,n){var r,i,l=[],a=0,s=e;for(s.length;i=s[a];a++)i&&1===i.nodeType&&(n&&i.childNodes?(r=this.filterElementsBy(i.childNodes,t))&&(l=l.concat(r)):t.call(this,i)&&l.push(i));return l},getElementHasClassNameCheck:function(e){return function(t){if(t&&t.classList)return t.classList.contains(e)}},getElementHasAttributeCheck:function(e,t){return t&&t.comparison?function(n){var r,i=!1;if(r=n.getAttribute(e))switch(t.comparison){case"=":i=r==t.value;break;case"~=":i=(" "+r+" ").indexOf(t.value)!==-1;break;case"*=":i=r.indexOf(t.value)!==-1;break;case"$=":i=r.lastIndexOf(t.value)==r.length-t.value.length;break;case"^=":i=0===r.indexOf(t.value);break;case"|=":i=!1}return i}:function(t){return t.hasAttribute(e)}},getElementHasTagNameCheck:function(e){return e=e.toUpperCase(),function(t){return t&&t.nodeName===e}},source:function(){return this.i.items},each:function(e,n){var r=this.source();if(!n&&(n=this),!is.callable(e))return t.error(new Error("t.array().each callback must be is.callable()."));for(var i=0,l=r,a=l.length;i<a;i++)e.call(n,l[i],i)},getItems:function(){return this.i.items},html:function(e){if(arguments.length&&is.element(e))return e.nodeValue}}),e.plugins.dom});