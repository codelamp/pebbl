t.matchbook={escape:"\\",create:function(t){return Object.create(this).prep(t)},clone:function(){var i=t.matchbook.create();return i.symbols=this.cloneItem(this.symbols),i.data=this.cloneItem(this.data),i.compiled=this.compiled,i.compiled&&i.compile(),i},cloneItem:function(t){if(t&&t.join)return t.slice(0);if(t){var i={};for(var r in t)i[r]=t[r];return i}},prep:function(t){return t?(this.compiled=!1,this.symbols=t,this.library=this._createCharacterLibrary(this.symbols),this.data={},this.length=this.symbols.length):(this.compiled=!1,this.symbols=[],this.library=null,this.data={},this.length=this.symbols.length),this},_createCharacterLibrary:function(t){var i,r,e,s={};for(i=t,r=0,e=i.length;s&&r<e;r++)this._addSymbolToLibrary(t[r],s);return s},_addSymbolToLibrary:function(t,i){var r,e,s,a,h=i||this.library,n=h;for(r=t,e=0,s=r.length;e<s;e++)(a=r[e])&&(e===s-1?n[a]?"string"!=typeof n[a]&&(n[a][""]=r):n[a]=r:n[a]||(n[a]={})),n=n[a]},compare:function(t,i,r){var e,s,a,h,n,o,l=this.library;if(this.escape){for(s=0,n=i||0;t.charAt(--n)===this.escape;)s++;if(1&s)return!1}for(h=!1,a=t,n=i||0,o=a.length;(e=a.charAt(n))&&n<o;n++){if(!l[e]){if(h)break;break}if("string"==typeof(l=l[e]))return l;l[""]&&(h=l[""])}return h&&r&&(h=this.userdata(h)),h},compile:function(){return this.library=this._createCharacterLibrary(this.symbols),this.compiled=!0,this},add:function(t,i){if("string"==typeof t)this.symbols.push(t),this.userdata(t,i),this.compiled&&this._addSymbolToLibrary(t);else if(t&&t.join)for(var r=0,e=t.length;r<e;r++)this.add(t[r],i);return this.length=this.symbols.length,this},userdata:function(t,i,r){if(arguments.length>1){if(this.data[t]||(this.data[t]=[]),r){for(var e=0,s=this.data[t];e<s.length;e++)if(s[e]===i){s.splice(e,1);break}}else this.data[t].push(i);return this}if(1===arguments.length)return this.data[t]}};