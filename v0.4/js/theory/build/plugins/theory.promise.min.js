async("theory.plugins.promise",["theory"],function(i){var e=i;return i.plugins=i.plugins||{},e.plugins.promise=e.creator.callable({i:{},create:function(i){return this.prep.apply(Object.create(this),arguments)},list:e.creator.callable({i:{promises:null},prep:function(){return this.i=Object.create(this.i),this.i.promises=[],this},add:function(i){return this.i.promises.push(is.promise(i)?i:new Promise(i)),this},getAll:function(){return Promise.all.call(Promise,this.i.promises)},getRace:function(){return Promise.race.call(Promise,this.i.promises)},get:function(){}}),prep:function(i){var e=this;return this.i=Object.create(this.i),i&&(this.i.resolution=function(t,s){e.i.resolve=t,e.i.reject=s,i&&i.apply(e,arguments)},this.i.promise=new Promise(this.i.resolution)),this},then:function(i,e){if(this.i.then){var t,s=this.i.then.slice(0),r=s.length;for(this.i.then.length=0,t=0;t<r;t++)this.then.apply(this,s[t])}return arguments.length&&(this.i.promise?this.i.promise.then.apply(this.i.promise,arguments):(this.i.then||(this.i.then=[]),this.i.then.push(arguments))),this},resolve:function(){return this.i.resolve?this.i.resolve.apply(null,arguments):(this.i.promise=Promise.resolve.apply(Promise,arguments),this.then()),this},reject:function(){return this.i.resolve?this.i.reject.apply(null,arguments):(this.i.promise=Promise.reject.apply(Promise,arguments),this.then()),this},getPromise:function(){return this.i.promise}}),e.plugins.promise});